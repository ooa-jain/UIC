{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Edit Profile - UIC Platform{% endblock %}

{% block extra_css %}
<style>
    .profile-edit-card {
        border: none;
        box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        border-radius: 0.5rem;
        overflow: hidden;
    }

    .profile-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 2rem;
        color: white;
        text-align: center;
    }

    .profile-header h3 {
        font-weight: 600;
        margin-bottom: 0.5rem;
    }

    .form-section {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .form-section h5 {
        color: #495057;
        font-weight: 600;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #667eea;
    }

    .form-section .bi {
        color: #667eea;
        margin-right: 0.5rem;
    }

    .form-control:focus, .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
    }

    .btn-save {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 0.75rem 2rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .btn-save:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.5rem 1rem rgba(102, 126, 234, 0.3);
    }

    .current-file {
        background: #e7f3ff;
        padding: 0.75rem;
        border-radius: 0.375rem;
        margin-top: 0.5rem;
    }

    .current-file i {
        color: #0d6efd;
    }

    .image-preview {
        max-width: 200px;
        max-height: 200px;
        border-radius: 0.5rem;
        box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        margin-top: 0.5rem;
    }

    label.required::after {
        content: " *";
        color: #dc3545;
    }
</style>
{% endblock %}

{% block content %}
<section class="py-5 bg-light">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="{% url 'accounts:profile' %}">Profile</a></li>
                <li class="breadcrumb-item active">Edit Profile</li>
            </ol>
        </nav>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card profile-edit-card">
                    <!-- Header -->
                    <div class="profile-header">
                        {% if user.user_type == 'student' %}
                            <i class="bi bi-person-circle display-4"></i>
                            <h3>Edit Student Profile</h3>
                            <p class="mb-0">Update your academic information and skills</p>
                        {% elif user.user_type == 'company' %}
                            <i class="bi bi-building display-4"></i>
                            <h3>Edit Company Profile</h3>
                            <p class="mb-0">Update your company information and details</p>
                        {% else %}
                            <i class="bi bi-bank display-4"></i>
                            <h3>Edit University Profile</h3>
                            <p class="mb-0">Update your university information and settings</p>
                        {% endif %}
                    </div>

                    <!-- Form -->
                    <div class="card-body p-4">
                        <form method="post" enctype="multipart/form-data" id="profileForm">
                            {% csrf_token %}

                            {% if user.user_type == 'student' %}
                                <!-- Academic Information -->
                                <div class="form-section">
                                    <h5><i class="bi bi-mortarboard-fill"></i>Academic Information</h5>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.student_id.id_for_label }}" class="form-label required">Student ID</label>
                                            {{ form.student_id }}
                                            {% if form.student_id.errors %}
                                                <div class="text-danger small">{{ form.student_id.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.department.id_for_label }}" class="form-label required">Department</label>
                                            {{ form.department }}
                                            {% if form.department.errors %}
                                                <div class="text-danger small">{{ form.department.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.year.id_for_label }}" class="form-label required">Year</label>
                                            {{ form.year }}
                                            {% if form.year.errors %}
                                                <div class="text-danger small">{{ form.year.errors }}</div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.gpa.id_for_label }}" class="form-label">GPA</label>
                                            {{ form.gpa }}
                                            <small class="form-text text-muted">Enter your CGPA (0-10 scale)</small>
                                            {% if form.gpa.errors %}
                                                <div class="text-danger small">{{ form.gpa.errors }}</div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label">
                                                <input type="checkbox" name="available_for_projects"
                                                       {% if form.available_for_projects.value %}checked{% endif %}>
                                                Available for Projects
                                            </label>
                                            <small class="form-text text-muted d-block">Check if you're open to new projects</small>
                                        </div>
                                    </div>
                                </div>

                                <!-- Personal Information -->
                                <div class="form-section">
                                    <h5><i class="bi bi-person-fill"></i>Personal Information</h5>
                                    <div class="mb-3">
                                        <label for="{{ form.bio.id_for_label }}" class="form-label">Bio</label>
                                        {{ form.bio }}
                                        <small class="form-text text-muted">Tell companies about yourself</small>
                                        {% if form.bio.errors %}
                                            <div class="text-danger small">{{ form.bio.errors }}</div>
                                        {% endif %}
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.profile_picture.id_for_label }}" class="form-label">Profile Picture</label>
                                            {{ form.profile_picture }}
                                            {% if form.instance.profile_picture %}
                                                <div class="current-file">
                                                    <i class="bi bi-image-fill"></i> Current:
                                                    <a href="{{ form.instance.profile_picture.url }}" target="_blank">View Image</a>
                                                    <img src="{{ form.instance.profile_picture.url }}" class="image-preview d-block" alt="Profile">
                                                </div>
                                            {% endif %}
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.resume.id_for_label }}" class="form-label">Resume</label>
                                            {{ form.resume }}
                                            {% if form.instance.resume %}
                                                <div class="current-file">
                                                    <i class="bi bi-file-earmark-pdf-fill"></i> Current:
                                                    <a href="{{ form.instance.resume.url }}" target="_blank">Download Resume</a>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.portfolio_url.id_for_label }}" class="form-label">Portfolio URL</label>
                                        {{ form.portfolio_url }}
                                        <small class="form-text text-muted">Link to your portfolio, GitHub, or personal website</small>
                                    </div>
                                </div>

                                <!-- Skills & Preferences -->
                                <div class="form-section">
                                    <h5><i class="bi bi-star-fill"></i>Skills & Preferences</h5>
                                    <div class="mb-3">
                                        <label for="{{ form.skills.id_for_label }}" class="form-label required">Skills</label>
                                        {{ form.skills }}
                                        <small class="form-text text-muted">Comma-separated (e.g., Python, Django, React, UI/UX Design)</small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.preferred_domains.id_for_label }}" class="form-label">Preferred Domains</label>
                                        {{ form.preferred_domains }}
                                        <small class="form-text text-muted">Comma-separated (e.g., Coding, Design, Marketing)</small>
                                    </div>
                                </div>

                            {% elif user.user_type == 'company' %}
                                <!-- Company Information -->
                                <div class="form-section">
                                    <h5><i class="bi bi-building"></i>Company Information</h5>
                                    <div class="row">
                                        <div class="col-md-8 mb-3">
                                            <label for="{{ form.name.id_for_label }}" class="form-label required">Company Name</label>
                                            {{ form.name }}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.logo.id_for_label }}" class="form-label">Logo</label>
                                            {{ form.logo }}
                                            {% if form.instance.logo %}
                                                <div class="current-file">
                                                    <i class="bi bi-image-fill"></i> Current:
                                                    <img src="{{ form.instance.logo.url }}" class="image-preview d-block" alt="Logo">
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.industry.id_for_label }}" class="form-label required">Industry</label>
                                            {{ form.industry }}
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.website.id_for_label }}" class="form-label">Website</label>
                                            {{ form.website }}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.description.id_for_label }}" class="form-label required">Description</label>
                                        {{ form.description }}
                                        <small class="form-text text-muted">Tell students about your company</small>
                                    </div>
                                </div>

                                <!-- Contact Information -->
                                <div class="form-section">
                                    <h5><i class="bi bi-telephone-fill"></i>Contact Information</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.contact_person.id_for_label }}" class="form-label required">Contact Person</label>
                                            {{ form.contact_person }}
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.contact_email.id_for_label }}" class="form-label required">Contact Email</label>
                                            {{ form.contact_email }}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.contact_phone.id_for_label }}" class="form-label">Contact Phone</label>
                                            {{ form.contact_phone }}
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.verification_document.id_for_label }}" class="form-label">Verification Document</label>
                                            {{ form.verification_document }}
                                            {% if form.instance.verification_document %}
                                                <div class="current-file">
                                                    <i class="bi bi-file-earmark-pdf-fill"></i>
                                                    <a href="{{ form.instance.verification_document.url }}" target="_blank">View Document</a>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.address.id_for_label }}" class="form-label required">Address</label>
                                        {{ form.address }}
                                    </div>
                                </div>

                            {% else %}
                                <!-- University Information -->
                                <div class="form-section">
                                    <h5><i class="bi bi-bank"></i>University Information</h5>
                                    <div class="row">
                                        <div class="col-md-8 mb-3">
                                            <label for="{{ form.name.id_for_label }}" class="form-label required">University Name</label>
                                            {{ form.name }}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.logo.id_for_label }}" class="form-label">Logo</label>
                                            {{ form.logo }}
                                            {% if form.instance.logo %}
                                                <div class="current-file">
                                                    <img src="{{ form.instance.logo.url }}" class="image-preview d-block" alt="Logo">
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.website.id_for_label }}" class="form-label">Website</label>
                                            {{ form.website }}
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.address.id_for_label }}" class="form-label required">Address</label>
                                            {{ form.address }}
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="{{ form.description.id_for_label }}" class="form-label">Description</label>
                                        {{ form.description }}
                                    </div>
                                </div>

                                <!-- Admin Contact -->
                                <div class="form-section">
                                    <h5><i class="bi bi-person-badge-fill"></i>Admin Contact</h5>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.admin_name.id_for_label }}" class="form-label required">Admin Name</label>
                                            {{ form.admin_name }}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.admin_email.id_for_label }}" class="form-label required">Admin Email</label>
                                            {{ form.admin_email }}
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <label for="{{ form.admin_phone.id_for_label }}" class="form-label required">Admin Phone</label>
                                            {{ form.admin_phone }}
                                        </div>
                                    </div>
                                </div>

                                <!-- Settings -->
                                <div class="form-section">
                                    <h5><i class="bi bi-gear-fill"></i>Settings</h5>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <div class="form-check">
                                                {{ form.auto_approve_projects }}
                                                <label class="form-check-label" for="{{ form.auto_approve_projects.id_for_label }}">
                                                    Auto-approve Projects
                                                </label>
                                                <small class="form-text text-muted d-block">Automatically approve all submitted projects</small>
                                            </div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="{{ form.min_payment_amount.id_for_label }}" class="form-label">Minimum Payment Amount</label>
                                            {{ form.min_payment_amount }}
                                            <small class="form-text text-muted">Minimum payment required for projects (â‚¹)</small>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}

                            <!-- Action Buttons -->
                            <div class="d-flex gap-3 justify-content-end mt-4">
                                <a href="{% url 'accounts:profile' %}" class="btn btn-outline-secondary btn-lg">
                                    <i class="bi bi-x-circle"></i> Cancel
                                </a>
                                <button type="submit" class="btn btn-primary btn-save btn-lg">
                                    <i class="bi bi-check-circle"></i> Save Changes
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add form-control class to all inputs
    const inputs = document.querySelectorAll('input:not([type="checkbox"]):not([type="file"]), textarea, select');
    inputs.forEach(input => {
        if (!input.classList.contains('form-control') && !input.classList.contains('form-select')) {
            input.classList.add('form-control');
        }
    });

    // Add form-select class to select elements
    const selects = document.querySelectorAll('select');
    selects.forEach(select => {
        select.classList.add('form-select');
    });

    // File input styling
    const fileInputs = document.querySelectorAll('input[type="file"]');
    fileInputs.forEach(input => {
        input.classList.add('form-control');
    });

    // Form validation feedback
    const form = document.getElementById('profileForm');
    form.addEventListener('submit', function(e) {
        if (!form.checkValidity()) {
            e.preventDefault();
            e.stopPropagation();
        }
        form.classList.add('was-validated');
    });
});
</script>
{% endblock %}